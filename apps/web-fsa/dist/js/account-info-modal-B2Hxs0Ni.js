var V=Object.defineProperty,$=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var P=(a,e,o)=>e in a?V(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,S=(a,e)=>{for(var o in e||(e={}))q.call(e,o)&&P(a,o,e[o]);if(w)for(var o of w(e))C.call(e,o)&&P(a,o,e[o]);return a},x=(a,e)=>$(a,k(e));var l=(a,e,o)=>new Promise((f,I)=>{var m=s=>{try{r(o.next(s))}catch(u){I(u)}},d=s=>{try{r(o.throw(s))}catch(u){I(u)}},r=s=>s.done?f(s.value):Promise.resolve(s.value).then(m,d);r((o=o.apply(a,e)).next())});import{u as F}from"./form-Dc7pQKZ8.js";import{bR as y,b1 as t,bS as N,bT as U,bL as p,bs as j}from"./bootstrap-BJQ4xY_l.js";import{a4 as R,P as b,J as v,aa as T,ab as A,ac as z,aD as E,av as B,aj as J,a7 as _,x as L}from"../jse/index-index-CZjfKQLv.js";import{u as G}from"./use-modal-DAPfi6Bw.js";function se(a){return l(this,null,function*(){return y.post("/accountinfos/list",a)})}function H(a){return l(this,null,function*(){return y.post("/accountinfos/create",a)})}function K(a,e){return l(this,null,function*(){return y.post(`/accountinfos/${a}/update`,e)})}function re(a){return l(this,null,function*(){return y.post(`/accountinfos/${a}/delete`)})}const Q={class:"account-info-modal p-4"},W={key:0,class:"flex-center py-10"},X={class:"text-center"},Y={key:1},Z=R({__name:"account-info-modal",setup(a){const e=b({}),o=v(()=>{var n;return(n=e.value)==null?void 0:n.isEdit}),f=v(()=>{var n;return(n=e.value)==null?void 0:n.accountInfoData}),I=v(()=>{var n;return(n=e.value)==null?void 0:n.activityId}),m=b(!1),d=b(!1),r=b([]),[s,u]=F({layout:"vertical",handleSubmit:O,submitButtonOptions:v(()=>({content:t("page.common.save"),disabled:d.value,loading:d.value})),resetButtonOptions:v(()=>({content:t("page.common.clear"),disabled:d.value})),commonConfig:{componentProps:{class:"w-full"}},schema:[{component:"Input",componentProps:{placeholder:t("page.accountInfo.accountPlaceholder")},fieldName:"account",label:t("page.accountInfo.account"),rules:"required"},{component:"Input",componentProps:{placeholder:t("page.accountInfo.passwordPlaceholder"),type:"password"},fieldName:"password",label:t("page.accountInfo.password"),rules:"required"},{component:"Select",componentProps:{placeholder:t("page.accountInfo.addressPlaceholder"),options:r},fieldName:"addressId",label:t("page.accountInfo.address"),rules:"required"}]}),[D,h]=G({title:t("page.accountInfo.accountInfoManagement"),draggable:!0,footer:!1,onOpenChange(n){return l(this,null,function*(){var c;if(n)if(e.value=h.getData()||{},yield M(),u.resetFields&&u.resetFields(),o.value&&f.value){const i=f.value;u.setValues({account:i.account,password:i.password,addressId:(c=i.address)==null?void 0:c.id})}else u.setValues({account:"",password:"",addressId:void 0})})}});function M(){return l(this,null,function*(){try{m.value=!0;const c=(yield N()).id;if(!c||typeof c!="number")throw new Error(t("page.accountInfo.invalidUserId"));const i=yield U(c);r.value=i.map(g=>({label:`${g.name} ${g.phone} ${g.fullAddress}`,value:g.id})),i.length===0&&(r.value=[{label:t("page.accountInfo.addAddressInProfile"),value:0,disabled:!0}])}catch(n){p.error(t("page.accountInfo.fetchUserAddressError")),r.value=[{label:t("page.accountInfo.fetchAddressRetry"),value:0,disabled:!0}]}finally{m.value=!1}})}function O(n){return l(this,null,function*(){try{if(d.value=!0,!I.value){p.error(t("page.accountInfo.activityIdRequired"));return}const c=x(S({},n),{activityId:I.value});o.value?(yield K(f.value.id,{account:n.account,password:n.password,addressId:n.addressId}),p.success(t("page.accountInfo.updateAccountInfoSuccess"))):(yield H(c),p.success(t("page.accountInfo.addAccountInfoSuccess"))),e.value.operationSuccess=!0,h.close()}catch(c){o.value?p.error(t("page.accountInfo.updateAccountInfoError")):p.error(t("page.accountInfo.addAccountInfoError"))}finally{d.value=!1}})}return(n,c)=>(A(),T(_(D),null,{default:z(()=>[E("div",Q,[m.value?(A(),B("div",W,[E("div",X,J(_(t)("page.common.loading")),1)])):(A(),B("div",Y,[L(_(s))]))])]),_:1}))}}),ee=j(Z,[["__scopeId","data-v-ed431983"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as A,ue as a,re as d,se as l};
