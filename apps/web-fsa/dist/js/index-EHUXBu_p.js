var p=(C,k,l)=>new Promise((A,y)=>{var m=i=>{try{f(l.next(i))}catch(g){y(g)}},n=i=>{try{f(l.throw(i))}catch(g){y(g)}},f=i=>i.done?A(i.value):Promise.resolve(i.value).then(m,n);f((l=l.apply(C,k)).next())});import{u as B}from"./form-B-jfQdK6.js";import{$ as a,a0 as d,Z as S,q as R}from"./bootstrap-nS_r6Uzy.js";import{g as K,a as L,d as j,A as Q,u as Z,b as G}from"./address-modal-DdlHRhDX.js";import{C as T,a as H,b as $,T as J}from"./index-CcPG30jJ.js";import W from"./index-Bs6a4Z0x.js";import{_ as X}from"./page.vue_vue_type_script_setup_true_lang-7X23zIuy.js";import{d as Y,r as P,Q as ee,f as ae,E as te,k as z,K as s,b as o,m as u,u as t,x as _,L as v,j as oe,l as se,F as ne}from"../jse/index-index-BsdptGcH.js";import{u as re}from"./use-modal-qTZq-J3o.js";import{a as x}from"./use-vben-form-qIoZL4uF.js";import"./index-nI7GpMDK.js";import"./shallowequal-BMhVrTHr.js";import"./Trigger-DmB6V4sb.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-CQR0eu18.js";import"./BaseInput-CIdroiOM.js";import"./index-Br3j_qDQ.js";import"./colors-D59xGIwT.js";import"./roundedArrow-EYTrNAJt.js";import"./collapseMotion-C22yorKZ.js";import"./slide-B2l4e1mx.js";import"./useRefs-Bl8svD-7.js";import"./responsiveObserve-7YYVRPOL.js";import"./DownOutlined-Cy6ShKlK.js";import"./useMergedState-DdQG7FS2.js";import"./EyeOutlined-BiKHx9cD.js";import"./index-BXkl_ASy.js";import"./index-DZFK9PNa.js";import"./CheckOutlined-zUdIMjW3.js";import"./SearchOutlined-8BTzpijE.js";import"./move-k9NGEOQn.js";import"./index-DhGJMtpN.js";import"./index-BGX4ANgK.js";import"./index-BpouPXFr.js";import"./FormItemContext-CbGyyj-A.js";import"./statusUtils-DG2SPV6v.js";import"./index-DFgcUpmS.js";import"./index-Bbbh6CzF.js";import"./Checkbox-BijoKviF.js";import"./index-CBzSDfyB.js";import"./index-CGfLNaW6.js";import"./index-BMGsZtLz.js";import"./x-BlW8OOV2.js";import"./checkbox.vue_vue_type_script_setup_true_lang-BsbbvZXe.js";import"./render-content.vue_vue_type_script_lang-0IkNOgdT.js";const ce={class:"p-4"},ie={class:"mb-4 text-2xl font-bold"},de={class:"mb-4"},le={class:"tab-content"},pe={class:"tab-content"},ue={class:"address-list"},me=Y({__name:"index",setup(C){const[k,l]=re({connectedComponent:Q,onOpenChange:e=>p(null,null,function*(){if(!e){const c=l.getData();c&&c.operationSuccess&&(yield h())}})});function A(){l.setState({title:a("page.account.addAddress")}).setData({addressData:null}).open()}function y(e){l.setState({title:a("page.account.editAddress")}).setData({addressData:e}).open()}const m=P(null),n=P(!1),[f,i]=B({layout:"horizontal",handleSubmit:e=>O(e),resetButtonOptions:{show:!1},schema:[{component:"Input",componentProps:{placeholder:a("page.account.usernamePlaceholder")},fieldName:"username",label:a("page.account.username"),rules:"required"},{component:"Input",componentProps:{placeholder:a("page.account.phonePlaceholder"),maxlength:11},fieldName:"phone",label:a("page.account.phone"),rules:x().regex(/^1[3-9]\d{9}$/,a("page.account.phoneFormatError"))},{component:"Input",componentProps:{placeholder:a("page.account.pushplusTokenPlaceholder")},fieldName:"pushplusToken",label:a("page.account.pushplusToken")}],submitButtonOptions:{content:a("page.common.save")}}),[g,D]=B({layout:"horizontal",handleSubmit:e=>{const{newPassword:c,confirmPassword:w}=e;if(c!==w){d.error(a("page.account.passwordMismatch"));return}return q(e)},schema:[{component:"InputPassword",componentProps:{placeholder:a("page.account.newPasswordPlaceholder")},fieldName:"newPassword",label:a("page.account.newPassword"),rules:x().min(6,a("page.account.passwordLengthError"))},{component:"InputPassword",componentProps:{placeholder:a("page.account.confirmPasswordPlaceholder")},fieldName:"confirmPassword",label:a("page.account.confirmPassword"),rules:x().min(1,a("page.account.confirmPasswordRequired"))}],submitButtonOptions:{content:a("page.common.save")},resetButtonOptions:{content:a("page.common.clear")}}),E=P(null),I=P([]),r=ee({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showTotal:e=>`${a("page.common.total")} ${e} ${a("page.common.items")}`}),F=[{title:a("page.common.seqNo"),key:"seq",width:60,customRender:({index:e})=>(r.current-1)*r.pageSize+e+1},{title:a("page.account.recipient"),dataIndex:"userName",key:"userName",width:100},{title:a("page.account.phone"),dataIndex:"mobilePhone",key:"mobilePhone",width:130},{title:a("page.account.address"),key:"address",customRender:({record:e})=>`${e.provinceName} ${e.cityName} ${e.districtName} ${e.addrDetail}`},{title:a("page.common.action"),key:"action",width:160}];function V(e){console.log("分页变化:",e),r.current=e.current,r.pageSize=e.pageSize,N()}function N(){var b;if(!((b=m.value)!=null&&b.addresses))return;const e=m.value.addresses;r.total=e.length;const c=((r.current||1)-1)*(r.pageSize||10),w=c+(r.pageSize||10);I.value=e.slice(c,w)}ae(()=>p(null,null,function*(){yield h(),yield M()}));function h(){return p(this,null,function*(){try{n.value=!0;const e=yield K();m.value=e,i.setValues({username:e.username,phone:e.phone,pushplusToken:e.pushplusToken||""}),e.addresses&&e.addresses.length>0?(r.current=1,N()):(I.value=[],r.total=0)}catch(e){d.error(a("page.account.fetchUserInfoError"))}finally{n.value=!1}})}function M(){return p(this,null,function*(){try{const e=yield L();E.value=e}catch(e){d.error(a("page.account.fetchAddressDataError"))}})}function O(e){return p(this,null,function*(){try{n.value=!0,yield Z(e),d.success(a("page.account.updateBasicInfoSuccess")),yield h()}catch(c){d.error(a("page.account.updateBasicInfoError"))}finally{n.value=!1}})}function q(e){return p(this,null,function*(){try{n.value=!0,yield G({newPassword:e.newPassword}),d.success(a("page.account.updatePasswordSuccess")),D.resetFields&&D.resetFields(),yield h()}catch(c){d.error(a("page.account.updatePasswordError"))}finally{n.value=!1}})}function U(e){return p(this,null,function*(){try{yield j({id:e.id}),d.success(a("page.account.deleteAddressSuccess")),yield h()}catch(c){d.error(a("page.account.deleteAddressError"))}})}return(e,c)=>(z(),te(t(X),null,{default:s(()=>[o(t(k)),u("div",ce,[u("h1",ie,_(t(a)("page.account.title")),1),u("div",de,[o(t(T),{loading:n.value,bordered:!1},{default:s(()=>[o(t(H),{class:"account-tabs"},{default:s(()=>[o(t($),{key:"basic",tab:t(a)("page.account.basicInfo")},{default:s(()=>[u("div",le,[o(t(f))])]),_:1},8,["tab"]),o(t($),{key:"password",tab:t(a)("page.account.modifyPassword")},{default:s(()=>[u("div",pe,[o(t(g))])]),_:1},8,["tab"])]),_:1})]),_:1},8,["loading"])]),o(t(W),null,{default:s(()=>[v(_(t(a)("page.account.addressManagement")),1)]),_:1}),u("div",ue,[o(t(T),{loading:n.value,bordered:!1},{extra:s(()=>[o(t(S),{type:"primary",onClick:A},{default:s(()=>[v(_(t(a)("page.account.addAddress")),1)]),_:1})]),default:s(()=>[o(t(J),{columns:F,dataSource:I.value,pagination:r,loading:n.value,rowKey:"id",scroll:{y:500},onChange:V},{bodyCell:s(({column:w,record:b})=>[w.key==="action"?(z(),oe(ne,{key:0},[o(t(S),{type:"link",onClick:()=>y(b)},{default:s(()=>[v(_(t(a)("page.common.edit")),1)]),_:2},1032,["onClick"]),o(t(S),{type:"link",danger:"",onClick:()=>U(b)},{default:s(()=>[v(_(t(a)("page.common.delete")),1)]),_:2},1032,["onClick"])],64)):se("",!0)]),_:1},8,["dataSource","pagination","loading"])]),_:1},8,["loading"])])])]),_:1}))}}),ra=R(me,[["__scopeId","data-v-bd1839e8"]]);export{ra as default};
