var g=(M,t,d)=>new Promise((m,p)=>{var f=r=>{try{u(d.next(r))}catch(a){p(a)}},o=r=>{try{u(d.throw(r))}catch(a){p(a)}},u=r=>r.done?m(r.value):Promise.resolve(r.value).then(f,o);u((d=d.apply(M,t)).next())});import{u as E}from"./form-B-jfQdK6.js";import{$ as s,a0 as l,a4 as b,a7 as U,q as V}from"./bootstrap-nS_r6Uzy.js";import{d as I,r as h,c,E as N,k as w,K as S,m as v,j as y,x as T,u as _,b as A}from"../jse/index-index-BsdptGcH.js";import{a as k}from"./use-vben-form-qIoZL4uF.js";import{u as B}from"./use-modal-qTZq-J3o.js";import"./index-BMGsZtLz.js";import"./checkbox.vue_vue_type_script_setup_true_lang-BsbbvZXe.js";import"./render-content.vue_vue_type_script_lang-0IkNOgdT.js";import"./x-BlW8OOV2.js";const C={class:"user-modal p-4"},D={key:0,class:"flex-center py-10"},q={class:"text-center"},O={key:1},R=I({__name:"user-modal",setup(M){const t=h({}),d=c(()=>{var e;return(e=t.value)==null?void 0:e.isEdit}),m=c(()=>{var e;return(e=t.value)==null?void 0:e.isPasswordMode}),p=c(()=>{var e;return(e=t.value)==null?void 0:e.userData}),f=h(!1),o=h(!1),u=[{component:"Input",componentProps:{style:{display:"none"}},fieldName:"_formMode",label:"",defaultValue:"create"},{component:"Input",componentProps:{placeholder:s("page.user.usernamePlaceholder")},fieldName:"username",label:s("page.user.username"),rules:"required",dependencies:{show:e=>e._formMode!=="password",triggerFields:["_formMode"]}},{component:"Input",componentProps:{placeholder:s("page.user.phonePlaceholder"),maxlength:11},fieldName:"phone",label:s("page.user.phone"),rules:k().regex(/^1[3-9]\d{9}$/,s("page.user.phoneFormatError")),dependencies:{show:e=>e._formMode!=="password",triggerFields:["_formMode"]}},{component:"InputPassword",componentProps:{placeholder:s("page.user.passwordPlaceholder"),style:{display:"flex",height:"32px"}},fieldName:"password",label:s("page.user.password"),dependencies:{show:e=>e._formMode!=="edit",rules:e=>k().min(6,s("page.user.passwordLengthError")),triggerFields:["_formMode"]}},{component:"InputPassword",componentProps:{placeholder:s("page.user.confirmPasswordPlaceholder"),style:{display:"flex",height:"32px"}},fieldName:"confirmPassword",label:s("page.user.confirmPassword"),dependencies:{show:e=>e._formMode!=="edit",rules:e=>"required",triggerFields:["_formMode"]}},{component:"Select",componentProps:{placeholder:s("page.user.rolePlaceholder"),options:[{label:s("page.user.roleAdmin"),value:"ADMIN"},{label:s("page.user.roleVip"),value:"VIP"},{label:s("page.user.roleUser"),value:"USER"}]},fieldName:"role",label:s("page.user.role"),defaultValue:"USER",rules:"required",dependencies:{show:e=>e._formMode!=="password",triggerFields:["_formMode"]}},{component:"Input",componentProps:{placeholder:s("page.user.pushplusTokenPlaceholder")},fieldName:"pushplusToken",label:s("page.user.pushplusToken"),dependencies:{show:e=>e._formMode!=="password",triggerFields:["_formMode"]}}],[r,a]=E({layout:"vertical",handleSubmit:F,submitButtonOptions:c(()=>({content:s("page.common.save"),disabled:o.value,loading:o.value})),resetButtonOptions:c(()=>({content:s("page.common.clear"),disabled:o.value})),commonConfig:{componentProps:{class:"w-full"}},schema:u}),[x,P]=B({title:s("page.user.userManagement"),draggable:!0,footer:!1,onOpenChange(e){return g(this,null,function*(){if(e)if(t.value=P.getData()||{},a.resetFields&&a.resetFields(),m.value&&p.value)a.setValues({_formMode:"password",password:"",confirmPassword:""});else if(d.value&&p.value){const n=p.value;a.setValues({_formMode:"edit",username:n.username,phone:n.phone,role:n.role,pushplusToken:n.pushplusToken||""})}else a.setValues({_formMode:"create",username:"",phone:"",password:"",confirmPassword:"",role:"USER",pushplusToken:""})})}});function F(e){return g(this,null,function*(){try{o.value=!0;const n=e._formMode;if(n==="password"){if(e.password!==e.confirmPassword){l.error(s("page.user.passwordMismatch")),o.value=!1;return}const i={password:e.password};yield b(p.value.id,i),l.success(s("page.user.passwordChangeSuccess"))}else if(n==="edit"){const i={username:e.username,phone:e.phone,role:e.role,pushplusToken:e.pushplusToken||null};yield b(p.value.id,i),l.success(s("page.user.updateUserSuccess"))}else{if(e.password!==e.confirmPassword){l.error(s("page.user.passwordMismatch")),o.value=!1;return}const i={username:e.username,password:e.password,phone:e.phone,role:e.role};yield U(i),l.success(s("page.user.addUserSuccess"))}t.value.operationSuccess=!0,P.close()}catch(n){e._formMode==="password"?l.error(s("page.user.passwordChangeError")):e._formMode==="edit"?l.error(s("page.user.updateUserError")):l.error(s("page.user.addUserError"))}finally{o.value=!1}})}return(e,n)=>(w(),N(_(x),null,{default:S(()=>[v("div",C,[f.value?(w(),y("div",D,[v("div",q,T(_(s)("page.common.loading")),1)])):(w(),y("div",O,[A(_(r))]))])]),_:1}))}}),X=V(R,[["__scopeId","data-v-2953adb5"]]);export{X as default};
