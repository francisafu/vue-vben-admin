var y=(a,o,s)=>new Promise((r,v)=>{var _=l=>{try{p(s.next(l))}catch(m){v(m)}},c=l=>{try{p(s.throw(l))}catch(m){v(m)}},p=l=>l.done?r(l.value):Promise.resolve(l.value).then(_,c);p((s=s.apply(a,o)).next())});import{u as S}from"./form-Dc7pQKZ8.js";import{bR as i,bL as g,bs as q}from"./bootstrap-BJQ4xY_l.js";import{a4 as C,P as w,J as d,aa as O,ab as u,ac as V,aD as t,av as b,aq as B,x as F,aj as h,a7 as k}from"../jse/index-index-CZjfKQLv.js";import{u as M}from"./use-modal-DAPfi6Bw.js";function oe(a){return i.post("/lorealdb/list",a)}function A(a){return i.post("/lorealdb/create",a)}function le(a){return i.post(`/lorealdb/${a}/read`)}function j(a,o){return i.post(`/lorealdb/${a}/update`,o)}function ne(a){return i.post(`/lorealdb/${a}/delete`)}function re(){return i.post("/lorealdb/hotsale",{},{responseType:"blob"})}function ce(a){return i.post("/activities/list",a)}const $={class:"loreal-database-modal p-4"},T={key:0,class:"flex-center py-10"},z={key:1},E={key:0,class:"mb-4 p-4 bg-gray-50 rounded"},H={class:"text-sm text-gray-600"},J={class:"mb-1"},R={class:"mb-1"},U={class:"mb-4 p-4 bg-blue-50 rounded"},G={class:"text-sm text-blue-600"},K={class:"flex items-start"},Q={key:0},W={key:1},X=C({__name:"loreal-database-modal",setup(a){const o=w({}),s=d(()=>{var e;return((e=o.value)==null?void 0:e.mode)==="update"}),r=d(()=>{var e;return(e=o.value)==null?void 0:e.database}),v=d(()=>{var e;return((e=o.value)==null?void 0:e.activityOptions)||[]}),_=w(!1),c=w(!1),p=[{component:"Select",componentProps:{placeholder:"请选择欧莱雅活动",options:v},fieldName:"activityId",label:"选择活动",rules:"required"},{component:"Input",componentProps:{placeholder:"请输入欧莱雅账号",autocomplete:"off"},fieldName:"account",label:"欧莱雅账号",rules:"required"},{component:"Input",componentProps:{placeholder:"请输入欧莱雅密码",autocomplete:"new-password",type:"password"},fieldName:"password",label:"欧莱雅密码",rules:"required"}],l=[{component:"Input",componentProps:{placeholder:"请输入欧莱雅账号",autocomplete:"off"},fieldName:"account",label:"欧莱雅账号",rules:"required"},{component:"Input",componentProps:{placeholder:"请输入欧莱雅密码",autocomplete:"new-password",type:"password"},fieldName:"password",label:"欧莱雅密码",rules:"required"}],[m,f]=S({layout:"vertical",handleSubmit:P,submitButtonOptions:d(()=>({content:s.value?"更新":"创建",disabled:c.value,loading:c.value})),resetButtonOptions:d(()=>({content:"清空",disabled:c.value})),commonConfig:{componentProps:{class:"w-full"}},schema:d(()=>s.value?l:p)}),[N,x]=M({title:d(()=>s.value?"更新欧莱雅数据库":"添加欧莱雅数据库"),draggable:!0,footer:!1,width:600,onOpenChange(e){return y(this,null,function*(){e&&(o.value=x.getData()||{},f.resetFields&&f.resetFields(),s.value&&r.value?f.setValues({account:"",password:""}):f.setValues({activityId:void 0,account:"",password:""}))})}});function P(e){return y(this,null,function*(){try{c.value=!0,s.value?(yield j(r.value.id,{account:e.account,password:e.password}),g.success("更新成功")):(yield A({activityId:e.activityId,account:e.account,password:e.password}),g.success("创建成功")),o.value.operationSuccess=!0,x.close()}catch(n){g.error(n.message||"操作失败")}finally{c.value=!1}})}return(e,n)=>(u(),O(k(N),null,{default:V(()=>{var D,I,L;return[t("div",$,[_.value?(u(),b("div",T,n[0]||(n[0]=[t("div",{class:"text-center"},"加载中...",-1)]))):(u(),b("div",z,[s.value?(u(),b("div",E,[t("div",H,[t("div",J,"活动ID: "+h((D=r.value)==null?void 0:D.activityId),1),t("div",R,"当前商品数: "+h((I=r.value)==null?void 0:I.productCount)+" 个",1),t("div",null,"上次爬取: "+h(new Date((L=r.value)==null?void 0:L.scrapedAt).toLocaleString()),1)])])):B("",!0),t("div",U,[t("div",G,[t("div",K,[n[1]||(n[1]=t("span",{class:"font-semibold mr-2"},"提示：",-1)),s.value?(u(),b("span",Q,"重新爬取将替换现有的所有商品数据")):(u(),b("span",W,"爬取可能需要几分钟时间，请耐心等待"))])])]),F(k(m)),n[2]||(n[2]=t("div",{class:"mt-4 p-4 bg-yellow-50 rounded"},[t("div",{class:"text-sm text-yellow-700"},[t("div",{class:"flex items-start"},[t("span",{class:"font-semibold mr-2"},"注意："),t("span",null,"请确保账号密码正确，且该账号有权限访问欧莱雅官网")])])],-1))]))])]}),_:1}))}}),Y=q(X,[["__scopeId","data-v-9a2219ca"]]),de=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{Y as L,oe as a,le as b,re as c,ne as d,ce as g,de as l};
