var G=Object.defineProperty,H=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var q=(t,n,s)=>n in t?G(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,B=(t,n)=>{for(var s in n||(n={}))L.call(n,s)&&q(t,s,n[s]);if(O)for(var s of O(n))Q.call(n,s)&&q(t,s,n[s]);return t},E=(t,n)=>H(t,J(n));var d=(t,n,s)=>new Promise((p,y)=>{var f=c=>{try{i(s.next(c))}catch(N){y(N)}},l=c=>{try{i(s.throw(c))}catch(N){y(N)}},i=c=>c.done?p(c.value):Promise.resolve(c.value).then(f,l);i((s=s.apply(t,n)).next())});import{u as R}from"./form-B-jfQdK6.js";import{s as g,$ as o,a0 as b,q as U}from"./bootstrap-nS_r6Uzy.js";import{d as W,r as h,c as A,E as X,k as _,K as Y,m as k,j as F,x as Z,u as D,b as ee}from"../jse/index-index-BsdptGcH.js";import{u as ae}from"./use-modal-qTZq-J3o.js";import{a as te}from"./use-vben-form-qIoZL4uF.js";function ye(){return d(this,null,function*(){return g.post("/account/info")})}function Pe(t){return d(this,null,function*(){return g.post("/account/basic",t)})}function Ne(t){return d(this,null,function*(){return g.post("/account/password",t)})}function oe(){return d(this,null,function*(){return g.post("/account/getaddrdata")})}function ne(t){return d(this,null,function*(){return g.post("/account/createaddr",t)})}function se(t){return d(this,null,function*(){return g.post("/account/updateaddr",t)})}function be(t){return d(this,null,function*(){return g.post("/account/deleteaddr",t)})}const ce={class:"address-modal p-4"},re={key:0,class:"flex-center py-10"},de={class:"text-center"},ie={key:1},le=W({__name:"address-modal",setup(t){const n=h({}),s=A(()=>{var e;return!!((e=n.value)!=null&&e.addressData)}),p=h(null),y=h(!1),f=h(!1),l=h(""),i=h(""),c=h(""),[N,S]=ae({title:o("page.account.addressManagement"),draggable:!0,footer:!1,onOpenChange(e){return d(this,null,function*(){if(e)if(n.value=S.getData()||{},yield I(),s.value){const a=n.value.addressData;r.updateSchema([{componentProps:{options:[]},fieldName:"city"},{componentProps:{options:[]},fieldName:"district"}]),l.value=a.provinceName,w(),i.value=a.cityName,x(),c.value=a.districtName;const u={userName:a.userName,mobilePhone:a.mobilePhone,province:a.provinceName,city:a.cityName,district:a.districtName,addrDetail:a.addrDetail};r.setValues(u)}else C();else C()})}});function C(){l.value="",i.value="",c.value="",r.resetFields&&r.resetFields(),r.setValues({userName:"",mobilePhone:"",province:void 0,city:void 0,district:void 0,addrDetail:""}),r.updateSchema([{componentProps:{options:[]},fieldName:"city"},{componentProps:{options:[]},fieldName:"district"}])}function I(){return d(this,null,function*(){try{y.value=!0;const e=yield oe();p.value=e,M()}catch(e){b.error(o("page.account.fetchAddressDataError"))}finally{y.value=!1}})}function M(){var a,u;const e=((u=(a=p.value)==null?void 0:a.address)==null?void 0:u.map(m=>({label:m.name,value:m.name})))||[];r.updateSchema([{componentProps:{options:e},fieldName:"province"}])}function w(){var u,m;if(!((u=p.value)!=null&&u.address)||!l.value)return;const e=p.value.address.find(v=>v.name===l.value);if(!e)return;const a=((m=e==null?void 0:e.children)==null?void 0:m.map(v=>({label:v.name,value:v.name})))||[];r.updateSchema([{componentProps:{options:a},fieldName:"city"}])}function x(){var m,v,V;if(!((m=p.value)!=null&&m.address)||!l.value||!i.value)return;const e=p.value.address.find(P=>P.name===l.value);if(!e)return;const a=(v=e==null?void 0:e.children)==null?void 0:v.find(P=>P.name===i.value);if(!a)return;const u=((V=a==null?void 0:a.children)==null?void 0:V.map(P=>({label:P.name,value:P.name})))||[];r.updateSchema([{componentProps:{options:u},fieldName:"district"}])}function j(e){l.value=e,i.value="",c.value="",w(),r.setValues({city:void 0,district:void 0})}function $(e){i.value=e,c.value="",x(),r.setValues({district:void 0})}function T(e){c.value=e}function z(e){return d(this,null,function*(){try{f.value=!0;const a={userName:e.userName,mobilePhone:e.mobilePhone,provinceName:e.province,cityName:e.city,districtName:e.district,addrDetail:e.addrDetail};s.value?(yield se(E(B({},a),{id:n.value.addressData.id})),b.success(o("page.account.updateAddressSuccess"))):(yield ne(a),b.success(o("page.account.addAddressSuccess"))),n.value.operationSuccess=!0,S.close()}catch(a){b.error(s.value?o("page.account.updateAddressError"):o("page.account.addAddressError"))}finally{f.value=!1}})}const[K,r]=R({layout:"vertical",handleSubmit:z,submitButtonOptions:A(()=>({content:o("page.common.save"),disabled:f.value,loading:f.value})),resetButtonOptions:A(()=>({content:o("page.common.clear"),disabled:f.value})),commonConfig:{componentProps:{class:"w-full"}},schema:[{component:"Input",componentProps:{placeholder:o("page.account.recipientPlaceholder")},fieldName:"userName",label:o("page.account.recipient"),rules:"required"},{component:"Input",componentProps:{placeholder:o("page.account.phonePlaceholder"),maxlength:11},fieldName:"mobilePhone",label:o("page.account.phone"),rules:te().regex(/^1[3-9]\d{9}$/,o("page.account.phoneFormatError"))},{component:"Select",componentProps:{placeholder:o("page.account.provincePlaceholder"),options:[],onChange:j,style:{width:"100%"}},fieldName:"province",label:o("page.account.province"),rules:"required"},{component:"Select",componentProps:{placeholder:o("page.account.cityPlaceholder"),options:[],onChange:$,style:{width:"100%"}},fieldName:"city",label:o("page.account.city"),rules:"required"},{component:"Select",componentProps:{placeholder:o("page.account.districtPlaceholder"),options:[],onChange:T,style:{width:"100%"}},fieldName:"district",label:o("page.account.district"),rules:"required"},{component:"Input",componentProps:{placeholder:o("page.account.addressDetailPlaceholder")},fieldName:"addrDetail",label:o("page.account.addressDetail"),rules:"required"}]});return(e,a)=>(_(),X(D(N),null,{default:Y(()=>[k("div",ce,[y.value?(_(),F("div",re,[k("div",de,Z(D(o)("page.account.loadingAddressData")),1)])):(_(),F("div",ie,[ee(D(K))]))])]),_:1}))}}),ue=U(le,[["__scopeId","data-v-243f301a"]]),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{ue as A,oe as a,Ne as b,Ae as c,be as d,ye as g,Pe as u};
