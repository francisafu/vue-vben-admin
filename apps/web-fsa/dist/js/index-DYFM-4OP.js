var K=Object.defineProperty,q=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var x=(i,o,e)=>o in i?K(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e,L=(i,o)=>{for(var e in o||(o={}))G.call(o,e)&&x(i,e,o[e]);if(k)for(var e of k(o))J.call(o,e)&&x(i,e,o[e]);return i},_=(i,o)=>q(i,F(o));var f=(i,o,e)=>new Promise((n,p)=>{var b=s=>{try{c(e.next(s))}catch(m){p(m)}},C=s=>{try{c(e.throw(s))}catch(m){p(m)}},c=s=>s.done?n(s.value):Promise.resolve(s.value).then(b,C);c((e=e.apply(i,o)).next())});import{b1 as A,as as v,bL as y,bs as Q}from"./bootstrap-BJQ4xY_l.js";import{g as W,a as X,b as Z,d as tt,c as at,L as et}from"./loreal-database-modal-C2MVj_Nr.js";import ot from"./loreal-database-detail-modal-BLo54Fk8.js";import{a4 as it,P as w,R as rt,a9 as nt,aa as st,ab as lt,ac as Y,x as l,a7 as r,aD as S,ai as M,a_ as g,k as d}from"../jse/index-index-CZjfKQLv.js";import{C as dt}from"./index-BQkm4ls3.js";import pt from"./index-BM9rJksX.js";import{_ as ct}from"./page.vue_vue_type_script_setup_true_lang-B9bC9-VS.js";import{T as mt}from"./index-DUDDivtd.js";import ut from"./index-C_OH3p1s.js";import{u as z}from"./use-modal-DAPfi6Bw.js";import{T as ft}from"./index-DLMgysYk.js";import{P as vt}from"./index-DSmVy39d.js";import"./form-Dc7pQKZ8.js";import"./use-vben-form-9RyIkVnb.js";import"./index-vlz9cqoy.js";import"./checkbox.vue_vue_type_script_setup_true_lang-obtDsCTt.js";import"./render-content.vue_vue_type_script_lang-DyZFyp8x.js";import"./index-DnbGjpnq.js";import"./responsiveObserve-DoomOr37.js";import"./isSymbol-C31Rw1Kw.js";import"./vnode-D8jwJZNd.js";import"./index-DLmHigjb.js";import"./FormItemContext-2Feh-36j.js";import"./statusUtils-BafBw23h.js";import"./BaseInput-Rv6b8NC9.js";import"./index-BuC4_ePy.js";import"./SearchOutlined-9BLVvX1_.js";import"./isPlainObject-B1TclPtS.js";import"./index-BGjYeiJD.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./EyeOutlined-DUjoKg0O.js";import"./useMergedState-Bh_I602w.js";import"./index-DxP7Q5m2.js";import"./shallowequal-DAHsgHgw.js";import"./Trigger-5OmG7_kU.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-yCxUNdPh.js";import"./index-DvMZm7Iy.js";import"./colors--zQ5faGU.js";import"./roundedArrow-EYTrNAJt.js";import"./collapseMotion-BT6S83uu.js";import"./slide-Ck_Vj4NP.js";import"./Dropdown-Bp5cfo1-.js";import"./useRefs-bVNVOK4Y.js";import"./hasIn-lNdCFDV4.js";import"./isMobile-8sZ0LT6r.js";import"./index-BeMQm5ge.js";import"./DownOutlined-DSHotxfp.js";import"./CheckOutlined-vre5dF4J.js";import"./move-BvB2OTP0.js";import"./useFlexGapSupport-txUzTNh4.js";import"./x-BkBkBKrZ.js";import"./index-C2Zr63jJ.js";import"./index-DXwAwwq7.js";import"./index-CUBibixF.js";import"./index-2uLRgq7k.js";import"./Checkbox-DiA9qKvl.js";import"./index-CGIEbGbJ.js";const yt={class:"mb-4"},gt={class:"flex items-center gap-4 mb-4"},bt=it({__name:"index",setup(i){const o=w([]),e=w(!1),n=rt({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:a=>`共 ${a} 条`}),p=w({page:1,pageSize:10,activityId:void 0}),b=w([]),C=w(!1),c=w(!1),[s,m]=z({connectedComponent:et,onOpenChange:a=>f(null,null,function*(){if(!a){const t=m.getData();t&&t.operationSuccess&&(yield D())}})}),[R,T]=z({connectedComponent:ot}),$=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:"活动",key:"activity",width:300,customRender:({record:a})=>{const{activity:t}=a;if(!t)return"-";const h=t.brand==="LOREAL"?"欧莱雅":t.brand,u=g(t.startTime).format("YYYY-MM-DD"),N=g(t.endTime).format("YYYY-MM-DD");return d("div",[d("div",`${h} - 活动ID: ${t.id}`),d("div",{class:"text-sm text-gray-500"},`${u} ~ ${N}`)])}},{title:"商品数量",dataIndex:"productCount",key:"productCount",width:120,align:"center",customRender:({record:a})=>d(mt,{color:"blue"},()=>`${a.productCount} 个`)},{title:"爬取时间",dataIndex:"scrapedAt",key:"scrapedAt",width:180,customRender:({record:a})=>g(a.scrapedAt).format("YYYY-MM-DD HH:mm:ss")},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180,customRender:({record:a})=>g(a.createdAt).format("YYYY-MM-DD HH:mm:ss")},{title:"操作",key:"action",width:200,fixed:"right",customRender:({record:a})=>d(ut,[d(v,{type:"link",size:"small",onClick:()=>V(a)},()=>"查看"),d(v,{type:"link",size:"small",onClick:()=>P(a)},()=>"更新"),d(vt,{title:"确定要删除这条记录吗？",onConfirm:()=>j(a)},()=>d(v,{type:"link",size:"small",danger:!0},()=>"删除"))])}];function I(){return f(this,null,function*(){try{C.value=!0;const{data:a}=yield W({page:1,pageSize:100,brand:"LOREAL"});a&&a.list&&(b.value=a.list.map(t=>({label:`活动${t.id} - ${g(t.startTime).format("YYYY-MM-DD")} ~ ${g(t.endTime).format("YYYY-MM-DD")}`,value:t.id})))}catch(a){y.error("获取活动列表失败")}finally{C.value=!1}})}function D(){return f(this,null,function*(){var a;try{e.value=!0;const{data:t}=yield X(_(L({},p.value),{page:n.current,pageSize:n.pageSize}));t&&(o.value=t.list||[],n.total=((a=t.pagination)==null?void 0:a.total)||0)}catch(t){y.error("获取数据库列表失败")}finally{e.value=!1}})}function H(){n.current=1,D()}function O(){p.value={page:1,pageSize:10,activityId:void 0},n.current=1,D()}function U(a){n.current=a.current,n.pageSize=a.pageSize,D()}function B(){m.setState({title:"添加欧莱雅数据库"}).setData({mode:"create",activityOptions:b.value}).open()}function V(a){return f(this,null,function*(){try{const{data:t}=yield Z(a.id);T.setState({title:"欧莱雅数据库详情"}).setData({database:t}).open()}catch(t){y.error("获取数据库详情失败")}})}function P(a){m.setState({title:"更新欧莱雅数据库"}).setData({mode:"update",database:a,activityOptions:b.value}).open()}function j(a){return f(this,null,function*(){try{yield tt(a.id),y.success("删除成功"),yield D()}catch(t){y.error("删除失败")}})}function E(){return f(this,null,function*(){try{c.value=!0;const a=yield at(),t=new Blob([a],{type:"text/plain;charset=utf-8"}),h=window.URL.createObjectURL(t),u=document.createElement("a");u.href=h,u.download=`热卖活动_${g().format("YYYY-MM-DD_HHmmss")}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h),y.success("下载成功")}catch(a){y.error("下载失败")}finally{c.value=!1}})}return nt(()=>{I(),D()}),(a,t)=>(lt(),st(r(ct),{"content-class":"p-4",title:r(A)("page.home.lorealDatabase")},{default:Y(()=>[l(r(s)),l(r(R)),l(r(dt),{title:r(A)("page.home.lorealDatabase")},{default:Y(()=>[S("div",yt,[S("div",gt,[l(r(pt),{value:p.value.activityId,"onUpdate:value":t[0]||(t[0]=h=>p.value.activityId=h),placeholder:"请选择活动",options:b.value,loading:C.value,allowClear:"",style:{width:"300px"}},null,8,["value","options","loading"]),l(r(v),{type:"primary",onClick:H},{default:Y(()=>t[1]||(t[1]=[M("搜索")])),_:1}),l(r(v),{onClick:O},{default:Y(()=>t[2]||(t[2]=[M("重置")])),_:1}),t[5]||(t[5]=S("div",{class:"flex-1"},null,-1)),l(r(v),{type:"primary",onClick:B},{default:Y(()=>t[3]||(t[3]=[M("添加数据库")])),_:1}),l(r(v),{type:"default",onClick:E,loading:c.value},{default:Y(()=>t[4]||(t[4]=[M(" 下载热卖活动 ")])),_:1},8,["loading"])])]),l(r(ft),{dataSource:o.value,columns:$,loading:e.value,pagination:n,onChange:U,scroll:{x:1200},rowKey:"id"},null,8,["dataSource","loading","pagination"])]),_:1},8,["title"])]),_:1},8,["title"]))}}),Ma=Q(bt,[["__scopeId","data-v-6f1da7fc"]]);export{Ma as default};
