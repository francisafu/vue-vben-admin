var h=(a,l,s)=>new Promise((d,f)=>{var c=n=>{try{v(s.next(n))}catch(b){f(b)}},w=n=>{try{v(s.throw(n))}catch(b){f(b)}},v=n=>n.done?d(n.value):Promise.resolve(n.value).then(c,w);v((s=s.apply(a,l)).next())});import{u as F}from"./form-B-jfQdK6.js";import{s as m,a0 as y,q as N}from"./bootstrap-nS_r6Uzy.js";import{d as P,r as x,c as r,E as V,k as u,K as A,m as e,j as p,b as M,x as g,u as S}from"../jse/index-index-BsdptGcH.js";import{u as O}from"./use-modal-qTZq-J3o.js";function j(a){return m.post("/lorealdb/create",a)}function de(a){return m.post("/lorealdb/activity",a)}function T(a,l){return m.post(`/lorealdb/${a}/update`,l)}function ce(a){return m.post(`/lorealdb/${a}/delete`)}function ie(){return m.post("/lorealdb/hotsale",{},{responseType:"blob"})}function ue(a){return m.post("/lorealdb/activities",a)}const E={class:"loreal-database-modal p-4"},$={key:0,class:"flex-center py-10"},z={key:1},H={class:"mb-4 p-4 bg-gray-50 rounded"},K={class:"text-sm text-gray-600"},U={key:0},G={class:"mb-1"},J={class:"mb-1"},Q={key:1},R={class:"mb-1"},W={class:"mb-4 p-4 bg-blue-50 rounded"},X={class:"text-sm text-blue-600"},Y={class:"flex items-start"},Z={key:0},ee={key:1},te=P({__name:"loreal-database-modal",setup(a){const l=x({}),s=r(()=>{var t;return((t=l.value)==null?void 0:t.mode)==="update"}),d=r(()=>{var t;return(t=l.value)==null?void 0:t.database}),f=x(!1),c=x(!1),w=r(()=>[{component:"Input",componentProps:{placeholder:"请输入欧莱雅账号",autocomplete:"off"},fieldName:"account",label:"欧莱雅账号",rules:"required"},{component:"Input",componentProps:{placeholder:"请输入欧莱雅密码",autocomplete:"new-password",type:"password"},fieldName:"password",label:"欧莱雅密码",rules:"required"}]),v=r(()=>[{component:"Input",componentProps:{placeholder:"请输入欧莱雅账号",autocomplete:"off"},fieldName:"account",label:"欧莱雅账号",rules:"required"},{component:"Input",componentProps:{placeholder:"请输入欧莱雅密码",autocomplete:"new-password",type:"password"},fieldName:"password",label:"欧莱雅密码",rules:"required"}]),n=r(()=>s.value?v.value:w.value),[b,_]=F({layout:"vertical",handleSubmit:C,submitButtonOptions:r(()=>({content:s.value?"更新":"创建",disabled:c.value,loading:c.value})),resetButtonOptions:r(()=>({content:"清空",disabled:c.value})),commonConfig:{componentProps:{class:"w-full"}},schema:n.value}),B=r(()=>s.value?"更新欧莱雅数据库":"添加欧莱雅数据库"),[q,D]=O({draggable:!0,footer:!1,onOpenChange(t){return h(this,null,function*(){t&&(l.value=D.getData()||{},_.resetFields&&_.resetFields(),s.value&&d.value?_.setValues({account:"",password:""}):_.setValues({account:"",password:""}))})}});function C(t){return h(this,null,function*(){var o;try{if(c.value=!0,s.value)yield T(d.value.id,{account:t.account,password:t.password}),y.success("更新成功");else{const i=(o=l.value)==null?void 0:o.activityId;if(!i){y.error("请先选择一个活动");return}yield j({activityId:i,account:t.account,password:t.password}),y.success("创建成功")}l.value.operationSuccess=!0,D.close()}catch(i){y.error(i.message||"操作失败")}finally{c.value=!1}})}return(t,o)=>(u(),V(S(q),{title:B.value},{default:A(()=>{var i,I,k,L;return[e("div",E,[f.value?(u(),p("div",$,o[0]||(o[0]=[e("div",{class:"text-center"},"加载中...",-1)]))):(u(),p("div",z,[e("div",H,[e("div",K,[s.value?(u(),p("div",U,[e("div",G,"活动ID: "+g((i=d.value)==null?void 0:i.activityId),1),e("div",J,"当前商品数: "+g((I=d.value)==null?void 0:I.productCount)+" 个",1),e("div",null,"上次爬取: "+g(new Date((k=d.value)==null?void 0:k.scrapedAt).toLocaleString()),1)])):(u(),p("div",Q,[e("div",R,"当前选择的活动ID: "+g((L=l.value)==null?void 0:L.activityId),1),o[1]||(o[1]=e("div",null,"即将为此活动爬取商品数据",-1))]))])]),e("div",W,[e("div",X,[e("div",Y,[o[2]||(o[2]=e("span",{class:"font-semibold mr-2"},"提示：",-1)),s.value?(u(),p("span",Z,"重新爬取将替换现有的所有商品数据")):(u(),p("span",ee,"爬取可能需要几分钟时间，请耐心等待"))])])]),M(S(b)),o[3]||(o[3]=e("div",{class:"mt-4 p-4 bg-yellow-50 rounded"},[e("div",{class:"text-sm text-yellow-700"},[e("div",{class:"flex items-start"},[e("span",{class:"font-semibold mr-2"},"注意："),e("span",null,"请确保账号密码正确，且该账号有权限访问欧莱雅官网")])])],-1))]))])]}),_:1},8,["title"]))}}),ae=N(te,[["__scopeId","data-v-9958a985"]]),pe=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{ae as L,ie as a,de as b,ce as d,ue as g,pe as l};
