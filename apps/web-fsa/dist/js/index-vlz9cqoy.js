import{a4 as m,aa as y,ab as D,ac as d,a8 as v,x as k,aV as w,a7 as g,aW as O,P as b,W as z,am as C,r as G}from"../jse/index-index-CZjfKQLv.js";import{b0 as M,bw as F}from"./bootstrap-BJQ4xY_l.js";const L=M("circle-help",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),U=m({inheritAttrs:!1,__name:"help-tooltip",props:{triggerClass:{}},setup(n){return(s,t)=>(D(),y(F,{"delay-duration":300,side:"right"},{trigger:d(()=>[v(s.$slots,"trigger",{},()=>[k(g(L),{class:w(g(O)("text-foreground/80 hover:text-foreground inline-flex size-5 cursor-pointer",s.triggerClass))},null,8,["class"])])]),default:d(()=>[v(s.$slots,"default")]),_:3}))}}),o=new WeakMap,u=new WeakMap,p={current:[]};let f=!1;const c=new Set,_=new Map;function V(n){const s=Array.from(n).sort((t,e)=>t instanceof l&&t.options.deps.includes(e)?1:e instanceof l&&e.options.deps.includes(t)?-1:0);for(const t of s){if(p.current.includes(t))continue;p.current.push(t),t.recompute();const e=u.get(t);if(e)for(const r of e){const i=o.get(r);i&&V(i)}}}function x(n){n.listeners.forEach(s=>s({prevVal:n.prevState,currentVal:n.state}))}function R(n){n.listeners.forEach(s=>s({prevVal:n.prevState,currentVal:n.state}))}function T(n){var s;if(c.add(n),!f)try{for(f=!0;c.size>0;){const t=Array.from(c);c.clear();for(const e of t){const r=(s=_.get(e))!=null?s:e.prevState;e.prevState=r,x(e)}for(const e of t){const r=o.get(e);r&&(p.current.push(e),V(r))}for(const e of t){const r=o.get(e);if(r)for(const i of r)R(i)}}}finally{f=!1,p.current=[],_.clear()}}class S{constructor(s,t){this.listeners=new Set,this.subscribe=e=>{var r,i;this.listeners.add(e);const a=(i=(r=this.options)==null?void 0:r.onSubscribe)==null?void 0:i.call(r,e,this);return()=>{this.listeners.delete(e),a==null||a()}},this.setState=e=>{var r,i,a;this.prevState=this.state,this.state=(r=this.options)!=null&&r.updateFn?this.options.updateFn(this.prevState)(e):e(this.prevState),(a=(i=this.options)==null?void 0:i.onUpdate)==null||a.call(i),T(this)},this.prevState=s,this.state=s,this.options=t}}class l{constructor(s){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{var r;const t=[],e=[];for(const i of this.options.deps)t.push(i.prevState),e.push(i.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:(r=this.prevState)!=null?r:void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:r,currDepVals:i,prevVal:a}=this.getDepVals();this.state=this.options.fn({prevDepVals:r,currDepVals:i,prevVal:a}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const i of this.options.deps)i instanceof l&&i.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:r}=this.getDepVals();for(let i=0;i<r.length;i++)if(r[i]!==e[i]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,r;this.listeners.add(t);const i=(r=(e=this.options).onSubscribe)==null?void 0:r.call(e,t,this);return()=>{this.listeners.delete(t),i==null||i()}},this.options=s,this.state=s.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(s=this.options.deps){for(const t of s)if(t instanceof l)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof S){let e=o.get(t);e||(e=new Set,o.set(t,e)),e.add(this);let r=u.get(this);r||(r=new Set,u.set(this,r)),r.add(t)}}unregisterFromGraph(s=this.options.deps){for(const t of s)if(t instanceof l)this.unregisterFromGraph(t.options.deps);else if(t instanceof S){const e=o.get(t);e&&e.delete(this);const r=u.get(this);r&&r.delete(t)}}}function $(n,s=t=>t){const t=b(s(n.state));return z(()=>n,(e,r,i)=>{const a=e.subscribe(()=>{const h=s(e.state);W(G(t.value),h)||(t.value=h)});i(()=>{a()})},{immediate:!0}),C(t)}function W(n,s){if(Object.is(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;if(n instanceof Map&&s instanceof Map){if(n.size!==s.size)return!1;for(const[e,r]of n)if(!s.has(e)||!Object.is(r,s.get(e)))return!1;return!0}if(n instanceof Set&&s instanceof Set){if(n.size!==s.size)return!1;for(const e of n)if(!s.has(e))return!1;return!0}const t=Object.keys(n);if(t.length!==Object.keys(s).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(s,t[e])||!Object.is(n[t[e]],s[t[e]]))return!1;return!0}export{L as C,S,U as _,$ as u};
