var g=Object.defineProperty,y=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var u=(t,e,s)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,l=(t,e)=>{for(var s in e||(e={}))p.call(e,s)&&u(t,s,e[s]);if(d)for(var s of d(e))x.call(e,s)&&u(t,s,e[s]);return t},T=(t,e)=>y(t,C(e));var w=(t,e)=>{var s={};for(var a in t)p.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&d)for(var a of d(t))e.indexOf(a)<0&&x.call(t,a)&&(s[a]=t[a]);return s};var c=(t,e,s)=>new Promise((a,n)=>{var i=r=>{try{h(s.next(r))}catch(m){n(m)}},f=r=>{try{h(s.throw(r))}catch(m){n(m)}},h=r=>r.done?a(r.value):Promise.resolve(r.value).then(i,f);h((s=s.apply(t,e)).next())});import{e3 as I}from"./bootstrap-nS_r6Uzy.js";import{e4 as U,e5 as K,dh as V,aM as q,aK as W}from"./bootstrap-nS_r6Uzy.js";import{cc as P,cd as R,bj as _,M as S,t as B}from"../jse/index-index-BsdptGcH.js";const N=I("core-tabbar",{actions:{_bulkCloseByPaths(t){return c(this,null,function*(){this.tabs=this.tabs.filter(e=>!t.includes(o(e))),this.updateCacheTabs()})},_close(t){const{fullPath:e}=t;if(b(t))return;const s=this.tabs.findIndex(a=>a.fullPath===e);s!==-1&&this.tabs.splice(s,1)},_goToDefaultTab(t){return c(this,null,function*(){if(this.getTabs.length<=0)return;const e=this.getTabs[0];e&&(yield this._goToTab(e,t))})},_goToTab(t,e){return c(this,null,function*(){const{params:s,path:a,query:n}=t,i={params:s||{},path:a,query:n||{}};yield e.replace(i)})},addTab(t){var a,n;const e=v(t);if(!A(e))return;const s=this.tabs.findIndex(i=>o(i)===o(t));if(s===-1){const i=S.tabbar.maxCount,f=(n=(a=t==null?void 0:t.meta)==null?void 0:a.maxNumOfOpenTab)!=null?n:-1;if(f>0&&this.tabs.filter(h=>h.name===t.name).length>=f){const h=this.tabs.findIndex(r=>r.name===t.name);h!==-1&&this.tabs.splice(h,1)}else if(i>0&&this.tabs.length>=i){const h=this.tabs.findIndex(r=>!Reflect.has(r.meta,"affixTab")||!r.meta.affixTab);h!==-1&&this.tabs.splice(h,1)}this.tabs.push(e)}else{const i=B(this.tabs)[s],f=T(l(l({},i),e),{meta:l(l({},i==null?void 0:i.meta),e.meta)});if(i){const h=i.meta;Reflect.has(h,"affixTab")&&(f.meta.affixTab=h.affixTab),Reflect.has(h,"newTabTitle")&&(f.meta.newTabTitle=h.newTabTitle)}this.tabs.splice(s,1,f)}this.updateCacheTabs()},closeAllTabs(t){return c(this,null,function*(){const e=this.tabs.filter(s=>b(s));this.tabs=e.length>0?e:[...this.tabs].splice(0,1),yield this._goToDefaultTab(t),this.updateCacheTabs()})},closeLeftTabs(t){return c(this,null,function*(){const e=this.tabs.findIndex(n=>o(n)===o(t));if(e<1)return;const s=this.tabs.slice(0,e),a=[];for(const n of s)b(n)||a.push(o(n));yield this._bulkCloseByPaths(a)})},closeOtherTabs(t){return c(this,null,function*(){const e=this.tabs.map(a=>o(a)),s=[];for(const a of e)if(a!==t.fullPath){const n=this.tabs.find(i=>o(i)===a);if(!n)continue;b(n)||s.push(o(n))}yield this._bulkCloseByPaths(s)})},closeRightTabs(t){return c(this,null,function*(){const e=this.tabs.findIndex(s=>o(s)===o(t));if(e!==-1&&e<this.tabs.length-1){const s=this.tabs.slice(e+1),a=[];for(const n of s)b(n)||a.push(o(n));yield this._bulkCloseByPaths(a)}})},closeTab(t,e){return c(this,null,function*(){const{currentRoute:s}=e;if(o(s.value)!==o(t)){this._close(t),this.updateCacheTabs();return}const a=this.getTabs.findIndex(f=>o(f)===o(s.value)),n=this.getTabs[a-1],i=this.getTabs[a+1];i?(this._close(t),yield this._goToTab(i,e)):n?(this._close(t),yield this._goToTab(n,e)):console.error("Failed to close the tab; only one tab remains open.")})},closeTabByKey(t,e){return c(this,null,function*(){const s=decodeURIComponent(t),a=this.tabs.findIndex(i=>o(i)===s);if(a===-1)return;const n=this.tabs[a];n&&(yield this.closeTab(n,e))})},getTabByPath(t){return this.getTabs.find(e=>o(e)===t)},openTabInNewWindow(t){return c(this,null,function*(){_(t.fullPath||t.path)})},pinTab(t){return c(this,null,function*(){var n;const e=this.tabs.findIndex(i=>o(i)===o(t));if(e!==-1){const i=this.tabs[e];t.meta.affixTab=!0,t.meta.title=(n=i==null?void 0:i.meta)==null?void 0:n.title,this.tabs.splice(e,1,t)}const a=this.tabs.filter(i=>b(i)).findIndex(i=>o(i)===o(t));yield this.sortTabs(e,a)})},refresh(t){return c(this,null,function*(){if(typeof t=="string")return yield this.refreshByName(t);const{currentRoute:e}=t,{name:s}=e.value;this.excludeCachedTabs.add(s),this.renderRouteView=!1,P(),yield new Promise(a=>setTimeout(a,200)),this.excludeCachedTabs.delete(s),this.renderRouteView=!0,R()})},refreshByName(t){return c(this,null,function*(){this.excludeCachedTabs.add(t),yield new Promise(e=>setTimeout(e,200)),this.excludeCachedTabs.delete(t)})},resetTabTitle(t){return c(this,null,function*(){var s;if((s=t==null?void 0:t.meta)!=null&&s.newTabTitle)return;const e=this.tabs.find(a=>o(a)===o(t));e&&(e.meta.newTabTitle=void 0,yield this.updateCacheTabs())})},setAffixTabs(t){for(const e of t)e.meta.affixTab=!0,this.addTab(k(e))},setMenuList(t){this.menuList=t},setTabTitle(t,e){return c(this,null,function*(){const s=this.tabs.find(a=>o(a)===o(t));s&&(s.meta.newTabTitle=e,yield this.updateCacheTabs())})},setUpdateTime(){this.updateTime=Date.now()},sortTabs(t,e){return c(this,null,function*(){const s=this.tabs[t];s&&(this.tabs.splice(t,1),this.tabs.splice(e,0,s),this.dragEndIndex=this.dragEndIndex+1)})},toggleTabPin(t){return c(this,null,function*(){var s,a;yield((a=(s=t==null?void 0:t.meta)==null?void 0:s.affixTab)!=null?a:!1)?this.unpinTab(t):this.pinTab(t)})},unpinTab(t){return c(this,null,function*(){var n;const e=this.tabs.findIndex(i=>o(i)===o(t));if(e!==-1){const i=this.tabs[e];t.meta.affixTab=!1,t.meta.title=(n=i==null?void 0:i.meta)==null?void 0:n.title,this.tabs.splice(e,1,t)}const a=this.tabs.filter(i=>b(i)).length;yield this.sortTabs(e,a)})},updateCacheTabs(){return c(this,null,function*(){var e;const t=new Set;for(const s of this.tabs){if(!((e=s.meta)==null?void 0:e.keepAlive))continue;(s.matched||[]).forEach((i,f)=>{f>0&&t.add(i.name)});const n=s.name;t.add(n)}this.cachedTabs=t})}},getters:{affixTabs(){return this.tabs.filter(e=>b(e)).sort((e,s)=>{var i,f,h,r;const a=(f=(i=e.meta)==null?void 0:i.affixTabOrder)!=null?f:0,n=(r=(h=s.meta)==null?void 0:h.affixTabOrder)!=null?r:0;return a-n})},getCachedTabs(){return[...this.cachedTabs]},getExcludeCachedTabs(){return[...this.excludeCachedTabs]},getMenuList(){return this.menuList},getTabs(){const t=this.tabs.filter(e=>!b(e));return[...this.affixTabs,...t].filter(Boolean)}},persist:[{pick:["tabs"],storage:sessionStorage}],state:()=>({cachedTabs:new Set,dragEndIndex:0,excludeCachedTabs:new Set,menuList:["close","affix","maximize","reload","open-in-new-window","close-left","close-right","close-other","close-all"],renderRouteView:!0,tabs:[],updateTime:Date.now()})});function v(t){if(!t)return t;const n=t,{matched:e,meta:s}=n,a=w(n,["matched","meta"]);return T(l({},a),{matched:e?e.map(i=>({meta:i.meta,name:i.name,path:i.path})):void 0,meta:T(l({},s),{newTabTitle:s.newTabTitle})})}function b(t){var e,s;return(s=(e=t==null?void 0:t.meta)==null?void 0:e.affixTab)!=null?s:!1}function A(t){var s;const e=(s=t==null?void 0:t.matched)!=null?s:[];return!t.meta.hideInTab&&e.every(a=>!a.meta.hideInTab)}function o(t){return decodeURIComponent(t.fullPath||t.path)}function k(t){return{meta:t.meta,name:t.name,path:t.path}}export{I as defineStore,U as initStores,K as resetAllStores,V as storeToRefs,q as useAccessStore,N as useTabbarStore,W as useUserStore};
