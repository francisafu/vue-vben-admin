var l=(D,A,p)=>new Promise((k,y)=>{var m=i=>{try{f(p.next(i))}catch(g){y(g)}},n=i=>{try{f(p.throw(i))}catch(g){y(g)}},f=i=>i.done?k(i.value):Promise.resolve(i.value).then(m,n);f((p=p.apply(D,A)).next())});import{u as T}from"./form-Dc7pQKZ8.js";import{b1 as a,bL as d,as as S,bs as U}from"./bootstrap-BJQ4xY_l.js";import{g as L,a as j,d as K,A as G,u as H,b as J}from"./address-modal-BdQuw8XC.js";import{C as B,T as Q,a as z}from"./index-BQkm4ls3.js";import W from"./index-DXJLT5DU.js";import{T as X}from"./index-DLMgysYk.js";import{_ as Y}from"./page.vue_vue_type_script_setup_true_lang-B9bC9-VS.js";import{a4 as Z,P,R as ee,a9 as ae,aa as te,ab as F,ac as s,x as o,aD as u,a7 as t,aj as _,ai as v,av as oe,aq as se,F as ne}from"../jse/index-index-CZjfKQLv.js";import{u as re}from"./use-modal-DAPfi6Bw.js";import{s as x}from"./use-vben-form-9RyIkVnb.js";import"./index-DxP7Q5m2.js";import"./shallowequal-DAHsgHgw.js";import"./Trigger-5OmG7_kU.js";import"./vnode-D8jwJZNd.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-yCxUNdPh.js";import"./index-BGjYeiJD.js";import"./index-DvMZm7Iy.js";import"./colors--zQ5faGU.js";import"./roundedArrow-EYTrNAJt.js";import"./collapseMotion-BT6S83uu.js";import"./slide-Ck_Vj4NP.js";import"./Dropdown-Bp5cfo1-.js";import"./useRefs-bVNVOK4Y.js";import"./hasIn-lNdCFDV4.js";import"./isSymbol-C31Rw1Kw.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-Bh_I602w.js";import"./isPlainObject-B1TclPtS.js";import"./index-C2Zr63jJ.js";import"./index-BeMQm5ge.js";import"./BaseInput-Rv6b8NC9.js";import"./DownOutlined-DSHotxfp.js";import"./CheckOutlined-vre5dF4J.js";import"./SearchOutlined-9BLVvX1_.js";import"./move-BvB2OTP0.js";import"./index-DXwAwwq7.js";import"./index-CUBibixF.js";import"./index-BM9rJksX.js";import"./FormItemContext-2Feh-36j.js";import"./statusUtils-BafBw23h.js";import"./responsiveObserve-DoomOr37.js";import"./index-BuC4_ePy.js";import"./index-2uLRgq7k.js";import"./Checkbox-DiA9qKvl.js";import"./index-CGIEbGbJ.js";import"./index-DLmHigjb.js";import"./EyeOutlined-DUjoKg0O.js";import"./index-vlz9cqoy.js";import"./x-BkBkBKrZ.js";import"./checkbox.vue_vue_type_script_setup_true_lang-obtDsCTt.js";import"./render-content.vue_vue_type_script_lang-DyZFyp8x.js";const ce={class:"p-4"},ie={class:"mb-4 text-2xl font-bold"},de={class:"mb-4"},pe={class:"tab-content"},le={class:"tab-content"},ue={class:"address-list"},me=Z({__name:"index",setup(D){const[A,p]=re({connectedComponent:G,onOpenChange:e=>l(null,null,function*(){if(!e){const c=p.getData();c&&c.operationSuccess&&(yield h())}})});function k(){p.setState({title:a("page.account.addAddress")}).setData({addressData:null}).open()}function y(e){p.setState({title:a("page.account.editAddress")}).setData({addressData:e}).open()}const m=P(null),n=P(!1),[f,i]=T({layout:"horizontal",handleSubmit:e=>O(e),resetButtonOptions:{show:!1},schema:[{component:"Input",componentProps:{placeholder:a("page.account.usernamePlaceholder")},fieldName:"username",label:a("page.account.username"),rules:"required"},{component:"Input",componentProps:{placeholder:a("page.account.phonePlaceholder"),maxlength:11},fieldName:"phone",label:a("page.account.phone"),rules:x().regex(/^1[3-9]\d{9}$/,a("page.account.phoneFormatError"))},{component:"Input",componentProps:{placeholder:a("page.account.pushplusTokenPlaceholder")},fieldName:"pushplusToken",label:a("page.account.pushplusToken")}],submitButtonOptions:{content:a("page.common.save")}}),[g,C]=T({layout:"horizontal",handleSubmit:e=>{const{newPassword:c,confirmPassword:w}=e;if(c!==w){d.error(a("page.account.passwordMismatch"));return}return q(e)},schema:[{component:"InputPassword",componentProps:{placeholder:a("page.account.newPasswordPlaceholder")},fieldName:"newPassword",label:a("page.account.newPassword"),rules:x().min(6,a("page.account.passwordLengthError"))},{component:"InputPassword",componentProps:{placeholder:a("page.account.confirmPasswordPlaceholder")},fieldName:"confirmPassword",label:a("page.account.confirmPassword"),rules:x().min(1,a("page.account.confirmPasswordRequired"))}],submitButtonOptions:{content:a("page.common.save")},resetButtonOptions:{content:a("page.common.clear")}}),$=P(null),I=P([]),r=ee({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showTotal:e=>`${a("page.common.total")} ${e} ${a("page.common.items")}`}),E=[{title:a("page.common.seqNo"),key:"seq",width:60,customRender:({index:e})=>(r.current-1)*r.pageSize+e+1},{title:a("page.account.recipient"),dataIndex:"userName",key:"userName",width:100},{title:a("page.account.phone"),dataIndex:"mobilePhone",key:"mobilePhone",width:130},{title:a("page.account.address"),key:"address",customRender:({record:e})=>`${e.provinceName} ${e.cityName} ${e.districtName} ${e.addrDetail}`},{title:a("page.common.action"),key:"action",width:160}];function V(e){console.log("分页变化:",e),r.current=e.current,r.pageSize=e.pageSize,N()}function N(){var b;if(!((b=m.value)!=null&&b.addresses))return;const e=m.value.addresses;r.total=e.length;const c=((r.current||1)-1)*(r.pageSize||10),w=c+(r.pageSize||10);I.value=e.slice(c,w)}ae(()=>l(null,null,function*(){yield h(),yield M()}));function h(){return l(this,null,function*(){try{n.value=!0;const e=yield L();m.value=e,i.setValues({username:e.username,phone:e.phone,pushplusToken:e.pushplusToken||""}),e.addresses&&e.addresses.length>0?(r.current=1,N()):(I.value=[],r.total=0)}catch(e){d.error(a("page.account.fetchUserInfoError"))}finally{n.value=!1}})}function M(){return l(this,null,function*(){try{const e=yield j();$.value=e}catch(e){d.error(a("page.account.fetchAddressDataError"))}})}function O(e){return l(this,null,function*(){try{n.value=!0,yield H(e),d.success(a("page.account.updateBasicInfoSuccess")),yield h()}catch(c){d.error(a("page.account.updateBasicInfoError"))}finally{n.value=!1}})}function q(e){return l(this,null,function*(){try{n.value=!0,yield J({newPassword:e.newPassword}),d.success(a("page.account.updatePasswordSuccess")),C.resetFields&&C.resetFields(),yield h()}catch(c){d.error(a("page.account.updatePasswordError"))}finally{n.value=!1}})}function R(e){return l(this,null,function*(){try{yield K({id:e.id}),d.success(a("page.account.deleteAddressSuccess")),yield h()}catch(c){d.error(a("page.account.deleteAddressError"))}})}return(e,c)=>(F(),te(t(Y),null,{default:s(()=>[o(t(A)),u("div",ce,[u("h1",ie,_(t(a)("page.account.title")),1),u("div",de,[o(t(B),{loading:n.value,bordered:!1},{default:s(()=>[o(t(Q),{class:"account-tabs"},{default:s(()=>[o(t(z),{key:"basic",tab:t(a)("page.account.basicInfo")},{default:s(()=>[u("div",pe,[o(t(f))])]),_:1},8,["tab"]),o(t(z),{key:"password",tab:t(a)("page.account.modifyPassword")},{default:s(()=>[u("div",le,[o(t(g))])]),_:1},8,["tab"])]),_:1})]),_:1},8,["loading"])]),o(t(W),null,{default:s(()=>[v(_(t(a)("page.account.addressManagement")),1)]),_:1}),u("div",ue,[o(t(B),{loading:n.value,bordered:!1},{extra:s(()=>[o(t(S),{type:"primary",onClick:k},{default:s(()=>[v(_(t(a)("page.account.addAddress")),1)]),_:1})]),default:s(()=>[o(t(X),{columns:E,dataSource:I.value,pagination:r,loading:n.value,rowKey:"id",scroll:{y:500},onChange:V},{bodyCell:s(({column:w,record:b})=>[w.key==="action"?(F(),oe(ne,{key:0},[o(t(S),{type:"link",onClick:()=>y(b)},{default:s(()=>[v(_(t(a)("page.common.edit")),1)]),_:2},1032,["onClick"]),o(t(S),{type:"link",danger:"",onClick:()=>R(b)},{default:s(()=>[v(_(t(a)("page.common.delete")),1)]),_:2},1032,["onClick"])],64)):se("",!0)]),_:1},8,["dataSource","pagination","loading"])]),_:1},8,["loading"])])])]),_:1}))}}),fa=U(me,[["__scopeId","data-v-bd1839e8"]]);export{fa as default};
