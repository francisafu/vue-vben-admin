const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index-CAw1lmdn.js","js/bootstrap-nS_r6Uzy.js","jse/index-index-BsdptGcH.js","css/bootstrap-BrS83-id.css"])))=>i.map(i=>d[i]);
var d=(l,c,p)=>new Promise((a,b)=>{var k=r=>{try{y(p.next(r))}catch(T){b(T)}},v=r=>{try{y(p.throw(r))}catch(T){b(T)}},y=r=>r.done?a(r.value):Promise.resolve(r.value).then(k,v);y((p=p.apply(l,c)).next())});import{s as S,ah as ae,$ as t,Z as N,a0 as m,q as te}from"./bootstrap-nS_r6Uzy.js";import{_ as se,d as oe,r as f,Q as re,V as F,c as Y,f as le,E as q,k as g,K as n,m as D,b as u,u as s,x as _,j as C,l as B,F as M,L as P,U as L}from"../jse/index-index-BsdptGcH.js";import{F as ie,a as E,U as de}from"./index-CsgQ6Jny.js";import{C as U,T as ne}from"./index-CcPG30jJ.js";import V from"./index-B67w507Q.js";import{D as ue}from"./dayjs-DmDMiJS0.js";import{u as ce}from"./use-drawer-BgiFUQmd.js";import pe from"./index-DTqBHIcz.js";function me(l){return d(this,null,function*(){const c=new FormData;return c.append("productsFile",l),S.post("/tasks/parseproducts",c,{headers:{"Content-Type":"multipart/form-data"}})})}function fe(l){return d(this,null,function*(){return S.post("/tasks/create",l)})}function ke(l,c){return d(this,null,function*(){return S.post(`/tasks/${l}/update`,c)})}function Be(l,c){return d(this,null,function*(){return S.post(`/tasks/${l}/copy`,c)})}function Me(l){return d(this,null,function*(){return S.post(`/tasks/${l}/delete`)})}function Le(l){return d(this,null,function*(){return S.post(`/tasks/${l}/start`)})}function Ue(l){return d(this,null,function*(){return S.post(`/tasks/${l}/cancel`)})}function Ve(l){return d(this,null,function*(){const{useAccessStore:c}=yield se(()=>d(null,null,function*(){const{useAccessStore:k}=yield import("./index-CAw1lmdn.js");return{useAccessStore:k}}),__vite__mapDeps([0,1,2,3])),a=c().accessToken;return(yield ae.post("/tasks/export-orders",l,{responseType:"blob",headers:{Authorization:a?`Bearer ${a}`:""}})).data})}const ge={class:"p-6"},ve={class:"grid grid-cols-2 gap-6 mb-4"},ye={class:"mt-1 text-xs text-gray-500"},he={class:"grid grid-cols-2 gap-6"},_e={key:1},be={class:"mt-1 text-xs text-gray-500"},De={key:0,class:"mb-4"},Se={class:"mt-2 text-xs text-gray-500"},Te={key:2,class:"text-center text-gray-500 py-8"},xe={class:"flex justify-end gap-3"},we=oe({__name:"account-info-task-drawer",setup(l){const[c,p]=ce({onCancel(){p.close()},onOpenChange(o){if(o){const e=p.getData();e&&(v.value=e.isEdit||!1,y.value=e.isView||!1,r.value=e.taskData||void 0,T.value=e.accountId||null,$.value=e.activityId||null,A.value=e.activityStartTime||null,(v.value||y.value)&&r.value?(a.ordersDelay=r.value.ordersDelay||1,a.isScheduled=r.value.isScheduled||!1,a.startTime=r.value.startTime?F(r.value.startTime):void 0,a.isPolling=r.value.isPolling||!1,a.products=r.value.products?[...r.value.products]:[]):z())}}}),a=re({ordersDelay:1,isScheduled:!1,startTime:void 0,isPolling:!1,products:[]}),b=f(),k=f(!1),v=f(!1),y=f(!1),r=f(void 0),T=f(null),$=f(null),A=f(null),w=f(!1),R=f([]),H=[{title:t("page.common.seqNo"),key:"seq",width:80,customRender:({index:o})=>o+1},{title:t("page.task.productCode"),dataIndex:"skuCode",key:"skuCode",width:160},{title:t("page.task.productName"),dataIndex:"productName",key:"productName",width:200,ellipsis:!0},{title:t("page.task.quantity"),dataIndex:"quantity",key:"quantity",width:100},{title:t("page.task.order"),key:"order",width:80,customRender:({record:o})=>o.order||"-"}],O={ordersDelay:[{required:!0,message:t("page.task.ordersDelayRequired")}]},j=o=>o&&o.isBefore(F().startOf("day"));function z(){var o;a.ordersDelay=1,a.isScheduled=!1,a.startTime=void 0,a.isPolling=!1,a.products=[],(o=b.value)==null||o.resetFields()}function K(){return d(this,null,function*(){try{if(yield b.value.validate(),a.products.length===0){m.warning(t("page.task.productRequired"));return}for(let o=0;o<a.products.length;o++){const e=a.products[o];if(!(e!=null&&e.skuCode)||!e.skuCode.trim()){m.warning(t("page.task.productCodeRequired",{index:o+1}));return}if(!(e!=null&&e.quantity)||e.quantity<=0){m.warning(t("page.task.productQuantityRequired",{index:o+1}));return}}if(k.value=!0,v.value&&r.value){const o={ordersDelay:a.ordersDelay,isScheduled:a.isScheduled,startTime:a.isScheduled&&a.startTime?a.startTime.format("YYYY-MM-DD HH:mm:ss"):void 0,isPolling:a.isPolling,products:a.products.map((e,i)=>({skuCode:e.skuCode.trim(),productName:e.productName||"",quantity:e.quantity,order:e.order||i+1}))};yield ke(r.value.id,o),m.success(t("page.task.updateSuccess"))}else{const o={accountId:T.value,activityId:$.value,ordersDelay:a.ordersDelay,isScheduled:a.isScheduled,startTime:a.isScheduled&&a.startTime?a.startTime.format("YYYY-MM-DD HH:mm:ss"):void 0,isPolling:a.isPolling,products:a.products.map((e,i)=>({skuCode:e.skuCode.trim(),productName:e.productName||"",quantity:e.quantity,order:e.order||i+1}))};yield fe(o),m.success(t("page.task.createSuccess"))}p.setData({operationSuccess:!0}),p.close()}catch(o){m.error(v.value?t("page.task.updateError"):t("page.task.createError"))}finally{k.value=!1}})}const Q=Y(()=>({type:"primary",loading:k.value,disabled:k.value})),Z=Y(()=>({disabled:k.value})),h=Y(()=>y.value);function G(){p.close()}le(()=>{});function J(o){return o.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"?o.size/1024/1024<10?!0:(m.error(t("page.task.fileSizeError")),!1):(m.error(t("page.task.excelFormatError")),!1)}function W(o){return d(this,null,function*(){const{file:e,fileList:i}=o;if(R.value=i,e.status==="uploading"){w.value=!0;return}e.status==="done"?(w.value=!1,m.success(`${e.name} ${t("page.task.uploadSuccess")}`),e.response&&e.response.products&&(a.products=e.response.products.map(x=>({skuCode:x.skuCode,quantity:x.quantity,productName:x.productName,order:x.order})),m.success(t("page.task.parseSuccess",{count:a.products.length})))):e.status==="error"&&(w.value=!1,m.error(`${e.name} ${t("page.task.uploadError")}`))})}function X(o){return d(this,null,function*(){const{file:e,onSuccess:i,onError:x,onProgress:qe}=o;try{const I=yield me(e);i(I)}catch(I){x(I)}})}function ee(o){const e=!!o;a.isScheduled=e,e&&A.value?a.startTime=F(A.value):e||(a.startTime=void 0)}return(o,e)=>(g(),q(s(c),{title:y.value?s(t)("page.task.viewTask"):v.value?s(t)("page.task.editTask"):s(t)("page.task.createTask")},{footer:n(()=>[D("div",xe,[u(s(N),L(Z.value,{onClick:G}),{default:n(()=>[P(_(h.value?s(t)("page.common.close"):s(t)("page.common.cancel")),1)]),_:1},16),h.value?B("",!0):(g(),q(s(N),L({key:0},Q.value,{onClick:K}),{default:n(()=>[P(_(v.value?s(t)("page.common.update"):s(t)("page.common.save")),1)]),_:1},16))])]),default:n(()=>[D("div",ge,[u(s(ie),{ref_key:"formRef",ref:b,model:a,rules:O,layout:"vertical"},{default:n(()=>[u(s(U),{title:s(t)("page.task.basicSettings"),class:"mb-4"},{default:n(()=>[D("div",ve,[u(s(E),{label:s(t)("page.task.isScheduled"),name:"isScheduled"},{default:n(()=>[u(s(V),{checked:a.isScheduled,"onUpdate:checked":e[0]||(e[0]=i=>a.isScheduled=i),onChange:ee,disabled:h.value},null,8,["checked","disabled"])]),_:1},8,["label"]),u(s(E),{label:s(t)("page.task.isPolling"),name:"isPolling"},{default:n(()=>[u(s(V),{checked:a.isPolling,"onUpdate:checked":e[1]||(e[1]=i=>a.isPolling=i),disabled:h.value},null,8,["checked","disabled"]),D("div",ye,_(s(t)("page.task.pollingDescription")),1)]),_:1},8,["label"])]),D("div",he,[a.isScheduled?(g(),q(s(E),{key:0,label:s(t)("page.task.startTime"),name:"startTime"},{default:n(()=>[u(s(ue),{value:a.startTime,"onUpdate:value":e[2]||(e[2]=i=>a.startTime=i),format:"YYYY-MM-DD HH:mm:ss","disabled-date":j,"show-time":{format:"HH:mm:ss"},placeholder:s(t)("page.task.startTimePlaceholder"),style:{width:"280px"},disabled:h.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])):(g(),C("div",_e)),u(s(E),{label:s(t)("page.task.ordersDelay"),name:"ordersDelay"},{default:n(()=>[u(s(pe),{value:a.ordersDelay,"onUpdate:value":e[3]||(e[3]=i=>a.ordersDelay=i),min:1,max:6e4,step:1,style:{width:"200px"},placeholder:s(t)("page.task.ordersDelayPlaceholder"),disabled:h.value},null,8,["value","placeholder","disabled"]),D("div",be,_(s(t)("page.task.ordersDelayDescription")),1)]),_:1},8,["label"])])]),_:1},8,["title"]),u(s(U),{title:s(t)("page.task.productSettings"),class:"mb-4"},{default:n(()=>[h.value?B("",!0):(g(),C("div",De,[u(s(de),{fileList:R.value,"before-upload":J,"custom-request":X,onChange:W,accept:".xlsx",multiple:!1,"max-count":1},{default:n(()=>[u(s(N),{type:"dashed",loading:w.value,style:{width:"100%"}},{default:n(()=>[w.value?(g(),C(M,{key:0},[P(_(s(t)("page.task.uploading")),1)],64)):(g(),C(M,{key:1},[P(_(s(t)("page.task.uploadExcel")),1)],64))]),_:1},8,["loading"])]),_:1},8,["fileList"]),D("div",Se,_(s(t)("page.task.fileFormat")),1)])),a.products.length>0?(g(),q(s(ne),{key:1,columns:H,dataSource:a.products,pagination:!1,size:"small",bordered:"",rowKey:"skuCode"},null,8,["dataSource"])):(g(),C("div",Te,_(h.value?s(t)("page.task.noProductData"):s(t)("page.task.uploadExcelPrompt")),1))]),_:1},8,["title"])]),_:1},8,["model"])])]),_:1},8,["title"]))}}),Ce=te(we,[["__scopeId","data-v-2a60b16c"]]),He=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{Ce as A,Be as a,He as b,Ue as c,Me as d,Ve as e,Le as s};
